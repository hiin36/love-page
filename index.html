<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kho·∫£nh kh·∫Øc c·ªßa ch√∫ng ta ‚ù§Ô∏è</title>
<!-- Minimal reset + nice font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1: linear-gradient(135deg,#FFD1DC 0%, #FFD6A5 50%, #FFDEE9 100%);
    --glass: rgba(255,255,255,0.6);
    --accent: #ff477e;
    --muted: #6b6b6b;
    --maxw: 980px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{
    background: var(--bg1);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:32px;
  }
  .card{
    width:100%;
    max-width:var(--maxw);
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
    border-radius:20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    overflow:hidden;
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:0;
  }

  /* left: video + controls */
  .left{
    padding:28px;
    display:flex;
    flex-direction:column;
    gap:18px;
    min-height:420px;
    align-items:center;
    justify-content:center;
  }
  .title{
    text-align:left;
    width:100%;
  }
  .title h1{margin:0;font-size:26px;letter-spacing:-0.3px;color:#3b2a30}
  .title p{margin:6px 0 0;color:var(--muted)}

  .player{
    width:100%;
    max-width:760px;
    background: #000;
    border-radius:12px;
    overflow:hidden;
    position:relative;
    box-shadow:0 8px 20px rgba(0,0,0,0.18);
  }
  video, iframe{width:100%;height:360px;border:0;display:block;background:#000}
  .controls{
    display:flex;
    gap:8px;
    margin-top:8px;
    align-items:center;
    flex-wrap:wrap;
  }
  button{
    background:var(--accent);
    color:white;border:0;padding:10px 14px;border-radius:10px;
    cursor:pointer;font-weight:600;
    box-shadow:0 6px 14px rgba(255,71,126,0.18);
  }
  button.secondary{
    background:transparent;color:var(--accent);border:2px solid rgba(255,71,126,0.12);
    box-shadow:none;padding:8px 12px;font-weight:700;
  }
  .muted{color:var(--muted);font-size:14px}

  /* right: card with message + QR + customisation */
  .right{
    padding:28px;background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.55));
    display:flex;flex-direction:column;gap:14px;
    align-items:stretch;justify-content:flex-start;
  }
  .message{
    background: linear-gradient(135deg, rgba(255,255,255,0.65), rgba(255,255,255,0.45));
    border-radius:12px;padding:16px;min-height:160px;
    display:flex;flex-direction:column;gap:8px;justify-content:center;
  }
  .message textarea{
    width:100%;border:0;background:transparent;resize:none;font-size:16px;
    font-weight:600;color:#3b2a30;height:120px;outline:none;
  }
  .qrWrap{display:flex;gap:12px;align-items:center;justify-content:space-between;}
  .qrBlock{display:flex;flex-direction:column;gap:8px;align-items:center}
  #qrcode{width:150px;height:150px;padding:8px;background:white;border-radius:8px;display:flex;align-items:center;justify-content:center}
  .small{font-size:13px;color:var(--muted)}

  .uploader{border:2px dashed rgba(0,0,0,0.06);padding:12px;border-radius:10px;text-align:center;color:var(--muted)}
  input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);outline:none}
  .shareRow{display:flex;gap:8px;align-items:center}

  footer{font-size:13px;color:var(--muted);margin-top:8px}
  .hearts{
    position:absolute;right:18px;top:18px;display:flex;gap:6px;pointer-events:none;
  }
  .heart{
    width:26px;height:26px;border-radius:50%;background:var(--accent);
    display:inline-block;transform:scale(0.9);box-shadow:0 6px 12px rgba(255,71,126,0.18);
    animation: pop 1.6s infinite ease-in-out;
  }
  .heart:nth-child(2){animation-delay:0.3s}
  .heart:nth-child(3){animation-delay:0.6s}
  @keyframes pop{
    0%{transform:translateY(0) scale(0.9);opacity:1}
    50%{transform:translateY(-18px) scale(1.2);opacity:0.9}
    100%{transform:translateY(0) scale(0.9);opacity:1}
  }

  /* responsive */
  @media (max-width:980px){
    .card{grid-template-columns:1fr;max-width:760px}
    video, iframe{height:260px}
  }
</style>
</head>
<body>
<div class="card" role="main" aria-labelledby="pageTitle">
  <div class="left">
    <div class="title">
      <h1 id="pageTitle">Cho b√© Hiin ‚Äî Kho·∫£nh kh·∫Øc c·ªßa ch√∫ng ta üíñ</h1>
      <p>Nh·∫•n play ƒë·ªÉ xem video k·ªâ ni·ªám. B√© c√≥ th·ªÉ s·ª≠a l·ªùi ch√∫c b√™n ph·∫£i.</p>
    </div>

    <div class="player" id="playerWrap">
      <!-- container for either <video> or YouTube iframe -->
      <div id="mediaContainer">
        <!-- Default: YouTube placeholder. Replace VIDEO_URL in the script below. -->
        <iframe id="ytiframe" src="https://www.youtube.com/embed/VIDEO_ID?rel=0&modestbranding=1&playsinline=1" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>
      </div>

      <div class="hearts" aria-hidden="true">
        <span class="heart"></span>
        <span class="heart"></span>
        <span class="heart"></span>
      </div>
    </div>

    <div class="controls" aria-hidden="false">
      <button id="playBtn">Play / Pause</button>
      <button id="muteBtn" class="secondary">Mute</button>
      <button id="swapBtn" class="secondary">Use local video</button>
      <div style="flex:1"></div>
      <span class="muted">Tip: Host this file online (GitHub Pages) so QR chia s·∫ª ho·∫°t ƒë·ªông.</span>
    </div>
  </div>

  <aside class="right" aria-label="Ch·ªânh s·ª≠a v√† chia s·∫ª">
    <div class="message">
      <label for="messageText" class="small">L·ªùi ch√∫c (b·∫•m s·ª≠a):</label>
      <textarea id="messageText" maxlength="400">B√© Hiin y√™u th∆∞∆°ng anh y√™u ‚Äî nh·ªØng kho·∫£nh kh·∫Øc n√†y l√† c·∫£ tr√°i tim em. ‚ù§Ô∏è‚Äçüî•</textarea>
      <div class="small">Pro-tip: Vi·∫øt l·ªùi ch√∫c ng·∫Øn r·ªìi nh·∫•n "T·∫£i xu·ªëng ·∫£nh" ƒë·ªÉ in thi·ªáp.</div>
    </div>

    <div class="uploader" id="uploader">
      <div class="small">D√°n link YouTube / direct .mp4 v√†o ƒë√¢y, ho·∫∑c k√©o th·∫£ 1 file video ƒë·ªÉ ph√°t c·ª•c b·ªô.</div>
      <input type="text" id="videoUrl" placeholder="V√≠ d·ª•: https://www.youtube.com/watch?v=xxxx OR https://example.com/video.mp4" style="margin-top:8px">
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="loadUrlBtn">Load video</button>
        <button id="clearLocal" class="secondary">Clear local</button>
      </div>
      <input type="file" id="fileInput" accept="video/*" style="margin-top:10px">
      <div class="small" style="margin-top:6px">L∆∞u √Ω: file local ch·ªâ xem ƒë∆∞·ª£c tr√™n m√°y n√†y. ƒê·ªÉ chia s·∫ª, upload video l√™n YouTube/Drive v√† d√°n link.</div>
    </div>

    <div class="qrWrap">
      <div class="qrBlock">
        <div id="qrcode" aria-hidden="true"></div>
        <div class="small">Qu√©t ƒë·ªÉ m·ªü trang (sau khi host)</div>
      </div>

      <div style="flex:1;display:flex;flex-direction:column;gap:8px">
        <div class="shareRow">
          <button id="downloadQR">T·∫£i QR (PNG)</button>
          <button id="downloadImg" class="secondary">T·∫£i ·∫£nh l·ªùi ch√∫c</button>
        </div>
        <div class="small">N·∫øu b√© host trang n√†y l√™n GitHub Pages, QR s·∫Ω tr·ªè t·ªõi trang ƒë√≥ ‚Äî m·ªçi ng∆∞·ªùi ch·ªâ c·∫ßn qu√©t v√† xem.</div>
      </div>
    </div>

    <footer>Made with love üíå ‚Äî s·ª≠a text, thay video, host v√† chia s·∫ª.</footer>
  </aside>
</div>

<!-- QR lib -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js" integrity="sha512-+D1a/oyVb9qst1E0mD9q8Gg07w6i9q8o6u0e1P5eYq6Y8h8VtqJxYwJ8G6c1Fa2EwN2r6iX1k2k5v0q1g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- html2canvas for screenshoting the message area -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5xk3KXkG5g9x0tP2j2i2V1hG6k8vQ2X9Z1fX4h6v2y2k1E8e" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
/*
  How to use quickly:
  - Replace the iframe src default "VIDEO_ID" with a real YouTube ID OR
  - Paste a YouTube url or .mp4 url into the input and click "Load video".
  - Or click "Use local video" then choose a file to preview locally.
  - Host this file online (GitHub Pages) so QR points to a public URL.
*/

const defaultYouTubeID = 'VIDEO_ID'; // <-- replace with your YouTube ID if hosting
const mediaContainer = document.getElementById('mediaContainer');
const playBtn = document.getElementById('playBtn');
const muteBtn = document.getElementById('muteBtn');
const swapBtn = document.getElementById('swapBtn');
const fileInput = document.getElementById('fileInput');
const videoUrlInput = document.getElementById('videoUrl');
const loadUrlBtn = document.getElementById('loadUrlBtn');
const clearLocal = document.getElementById('clearLocal');
const qrcodeDiv = document.getElementById('qrcode');
const downloadQR = document.getElementById('downloadQR');
const downloadImg = document.getElementById('downloadImg');
const messageText = document.getElementById('messageText');

let currentPlayer = { type:'youtube', node: document.getElementById('ytiframe') };
let localObjectURL = null;

// init QR pointing to location.href
const qr = new QRious({
  element: qrcodeDiv,
  value: window.location.href,
  size: 150,
  level: 'H'
});

// Download QR as PNG
downloadQR.addEventListener('click', () => {
  const dataUrl = qr.toDataURL();
  const a = document.createElement('a');
  a.href = dataUrl;
  a.download = 'qr_khoanhkhac.png';
  a.click();
});

// Download message area as image
downloadImg.addEventListener('click', async () => {
  const messageArea = document.querySelector('.message');
  const canvas = await html2canvas(messageArea, {backgroundColor: null, scale: 2});
  const dataUrl = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = dataUrl;
  a.download = 'loichuc.png';
  a.click();
});

// Play/pause logic for either video or youtube iframe
playBtn.addEventListener('click', () => {
  if(currentPlayer.type === 'mp4'){
    const v = currentPlayer.node;
    if(v.paused) v.play(); else v.pause();
  } else if(currentPlayer.type === 'youtube'){
    // toggle by postMessage play/pause - send to iframe using player API (simple hack)
    // Notice: this works better if YouTube Iframe API is used; this is a lightweight toggle:
    const iframe = currentPlayer.node;
    // try to autoplay/pause via src toggling (simple approach)
    // Better approach: use YouTube Player API if you need robust control.
    alert('V·ªõi video YouTube, d√πng controls trong iframe ƒë·ªÉ play/pause (ho·∫∑c paste direct .mp4).');
  }
});

// Mute button
muteBtn.addEventListener('click', () => {
  if(currentPlayer.type === 'mp4'){
    const v = currentPlayer.node;
    v.muted = !v.muted;
    muteBtn.textContent = v.muted ? 'Unmute' : 'Mute';
  } else {
    alert('Mute/unmute kh·∫£ d·ª•ng cho video mp4 c·ª•c b·ªô/hosted. N·∫øu l√† YouTube, d√πng icon trong player.');
  }
});

// Swap to local video mode (open file dialog)
swapBtn.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if(!file) return;
  if(localObjectURL) URL.revokeObjectURL(localObjectURL);
  localObjectURL = URL.createObjectURL(file);
  loadMP4(localObjectURL);
});

// Load URL (YouTube or mp4)
loadUrlBtn.addEventListener('click', () => {
  const url = videoUrlInput.value.trim();
  if(!url) { alert('D√°n link YouTube ho·∫∑c .mp4 v√†o √¥ input.'); return; }
  if(isYouTubeUrl(url)){
    const id = extractYouTubeID(url);
    loadYouTube(id);
  } else if(url.endsWith('.mp4') || url.includes('drive.google.com') || url.includes('dropbox.com')){
    // If Google Drive or Dropbox, user must make direct link to file.
    loadMP4(url);
  } else {
    // try mp4 anyway
    loadMP4(url);
  }
});

// clear local object url
clearLocal.addEventListener('click', () => {
  if(localObjectURL){ URL.revokeObjectURL(localObjectURL); localObjectURL = null; }
  // reload default youtube iframe
  loadYouTube(defaultYouTubeID);
});

// helpers
function isYouTubeUrl(u){
  return /youtube\.com|youtu\.be/.test(u);
}
function extractYouTubeID(url){
  // common patterns
  try {
    let id = null;
    const ytShort = url.match(/youtu\.be\/([^\?&]+)/);
    if(ytShort) return ytShort[1];
    const vParam = url.match(/[?&]v=([^&]+)/);
    if(vParam) return vParam[1];
    const embed = url.match(/\/embed\/([^?&/]+)/);
    if(embed) return embed[1];
    return url; // fallback
  } catch(e){ return url; }
}
function clearMedia(){
  mediaContainer.innerHTML = '';
  currentPlayer = {type:null,node:null};
}
function loadYouTube(id){
  clearMedia();
  const iframe = document.createElement('iframe');
  iframe.src = `https://www.youtube.com/embed/${encodeURIComponent(id)}?rel=0&modestbranding=1&playsinline=1`;
  iframe.allow = 'autoplay; encrypted-media; picture-in-picture';
  iframe.allowFullscreen = true;
  mediaContainer.appendChild(iframe);
  currentPlayer = {type:'youtube', node:iframe};
}
function loadMP4(src){
  clearMedia();
  const video = document.createElement('video');
  video.src = src;
  video.controls = true;
  video.playsInline = true;
  video.preload = 'metadata';
  video.style.background = '#000';
  mediaContainer.appendChild(video);
  currentPlayer = {type:'mp4', node:video};
}

// initial load: if defaultYouTubeID changed, load it; else keep placeholder
if(defaultYouTubeID && defaultYouTubeID !== 'VIDEO_ID'){
  loadYouTube(defaultYouTubeID);
}

// Update QR value if page URL changes (e.g., on deploy path) or when user wants
window.addEventListener('load', ()=> qr.value = window.location.href);

// drag & drop for uploader (local preview)
const uploader = document.getElementById('uploader');
['dragenter','dragover'].forEach(ev => uploader.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); uStyle(true)} ));
['dragleave','drop'].forEach(ev => uploader.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); uStyle(false)} ));
uploader.addEventListener('drop', (e)=>{
  const file = e.dataTransfer.files[0];
  if(file && file.type.startsWith('video')){
    if(localObjectURL) URL.revokeObjectURL(localObjectURL);
    localObjectURL = URL.createObjectURL(file);
    loadMP4(localObjectURL);
  } else {
    alert('Vui l√≤ng k√©o th·∫£ 1 file video.');
  }
});
function uStyle(active){ uploader.style.borderColor = active ? 'rgba(255,71,126,0.6)' : 'rgba(0,0,0,0.06)'; }

// Accessibility: allow editing message and storing locally
messageText.addEventListener('input', () => {
  // optional: autosave to localStorage
  localStorage.setItem('love_message', messageText.value);
});
const stored = localStorage.getItem('love_message');
if(stored) messageText.value = stored;

// OPTIONAL: If you host this page, you may want to update the QR to use a shortened url or final url.
// You can also change qr.value manually via JS:
// qr.value = 'https://your-hosted-page.example.com';

// End of script
</script>
</body>
</html>
